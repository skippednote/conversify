<!DOCTYPE html>

<html>
<head>
  <title>New Message Helper</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          
          <h1 id="new-message-helper">New Message Helper</h1>
<p>We are using New Message template helper to add new items to our database. It is bound to the New Message template and grabs the data from there.
When we enter our message in the input field and click the button, the new message helper grabs will create a object hash <code>messageData</code> and use key:value properties of the object to store various fields of the message. To grab the message body we are using jQuery, a DOM manipulation library that comes bundled with Meteor.</p>
<p>We have the following field:</p>
<ul>
<li>Message:  to get the message to be sent</li>
<li>author: to get the author who post the message</li>
<li>avatar: to get the image of author from twitter</li>
</ul>
<p>The message are wrapped inside <code>Emoji.conver()</code> function, this will find if there is any emoji code in our message and if there is, it will parse it and render it to the user.</p>
<p>We use Mongo&#39;s <code>Messages.insert()</code> API to add content to the database. Here we will pass the <code>messsageData</code> object hash to it. Once the data is added to the database we will set the value of the input field to empty.</p>

          
            <div class='highlight'><pre>Template.newMessage.events({
    <span class="string">'submit form'</span>: <span class="reserved">function</span>(e) {
        e.preventDefault();
        <span class="reserved">var</span> user = Meteor.user();
        <span class="reserved">var</span> id = user._id;
        <span class="reserved">var</span> author = user.profile.name;
        <span class="reserved">var</span> avatar = user.services.twitter.profile_image_url;

        <span class="reserved">var</span> messageData = {
            <span class="attribute">message</span>: Emoji.convert($(e.target).find(<span class="string">'[name=message]'</span>).val()),
            <span class="attribute">author</span>: author,
            <span class="attribute">avatar</span>: avatar,
            <span class="attribute">owner</span>: id,
            <span class="attribute">date</span>: <span class="keyword">new</span> Date()
        };

        Messages.insert(messageData);
        $(e.target).find(<span class="string">'[name=message]'</span>).val(<span class="string">''</span>);
    }
});</pre></div>
          
        

        
          <div class="toc">
            <h3>Table of Contents</h3>
            <ol>
              
                
                <li>
                  <a class="source" href="collection.html">
                    collection.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="bootstrap.html">
                    bootstrap.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="v8.html">
                    v8.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="handlebars.html">
                    handlebars.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="javascript.html">
                    javascript.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="meteor.html">
                    meteor.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="node.html">
                    node.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="nosql.html">
                    nosql.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="v8.html">
                    v8.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="websocket.html">
                    websocket.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="handlebarsHelper.html">
                    handlebarsHelper.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="messagelistHelper.html">
                    messagelistHelper.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="newmessageHelper.html">
                    newmessageHelper.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="about.html">
                    about.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="certificate.html">
                    certificate.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="application.html">
                    application.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="messageList.html">
                    messageList.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="newMessage.html">
                    newMessage.coffee
                  </a>
                </li>
              
            </ol>
          </div>
        
      </div>

      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
